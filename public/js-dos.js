!function s(r,a,l){function u(t,e){if(!a[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=a[t]={exports:{}};r[t][0].call(i.exports,function(e){return u(r[t][1][e]||e)},i,i.exports,s,r,a,l)}return a[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Build={version:"6.22-9d2cf856faaa91e726b1bcc49972c2a95849c30d",wasmSize:2167540,jsSize:503536}},{}],2:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function n(e,t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.shellInputQueue=[],this.shellInputClients=[],this.dos=e,this.em=e,this.api=e,this.api.ping=function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];i.onping(e,n)},this.onready=t}return o(n,[{key:"width",value:function(){return this.dos.canvas.width}},{key:"height",value:function(){return this.dos.canvas.height}},{key:"shell",value:function(){for(var l=this,e=arguments.length,u=Array(e),t=0;t<e;t++)u[t]=arguments[t];if(0!==u.length)return new Promise(function(e,t){l.shellInputClients.push(e);var n=!0,o=!1,i=void 0;try{for(var s,r=u[Symbol.iterator]();!(n=(s=r.next()).done);n=!0){var a=s.value;l.shellInputQueue.push(a)}}catch(e){o=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw i}}l.requestShellInput()})}},{key:"screenshot",value:function(){var e=this;return new Promise(function(t){e.api.send("screenshot","",function(e){t(e)})})}},{key:"exit",value:function(){try{this.api.send("exit")}catch(e){return 0}return this.dos.error("Runtime is still alive!"),-1}},{key:"sendKeyPress",value:function(e){this.api.send("sdl_key_event",e+"")}},{key:"requestShellInput",value:function(){this.sendKeyPress(13)}},{key:"onping",value:function(e,t){switch(e){case"ready":this.onready(this);break;case"shell_input":if(0===this.shellInputQueue.length)return;var n=t[0],o=t[1],i=this.shellInputQueue.shift(),s=this.em.lengthBytesUTF8(i)+1;if(o<s)return void this.dos.onerror("Can't execute cmd '"+i+"', because it's bigger then max cmd length "+o);if(this.em.stringToUTF8(i,n,s),0===this.shellInputQueue.length){var r=!0,a=!1,l=void 0;try{for(var u,c=this.shellInputClients[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){(0,u.value)()}}catch(e){a=!0,l=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw l}}this.shellInputClients=[]}else this.requestShellInput()}}}]),n}();n.DosCommandInterface=i},{}],3:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("./js-dos-xhr"),i=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.dos=e,this.em=e}return o(t,[{key:"extract",value:function(n){var r=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"zip";return new Promise(function(i,s){"zip"===e?new a.Xhr(n,{responseType:"arraybuffer",fail:function(e){return s(e)},progress:function(e,t){return r.dos.onprogress("Downloading "+n,e,t)},success:function(e){var t=new Uint8Array(e),n=r.em._malloc(t.length);r.em.HEAPU8.set(t,n);var o=r.em._extract_zip(n,t.length);r.em._free(n),0===o?i():s("Can't extract zip, retcode "+o+", see more info in logs")}}):s("Only ZIP archive is supported")})}}]),t}();n.DosFS=i},{"./js-dos-xhr":8}],4:[function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var c=e("./js-dos-build"),f=e("./js-dos-xhr"),s=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.wasmSupported=!1,this.global=window,this.wdosboxPromise=null,this.global.exports={};try{if("object"===("undefined"==typeof WebAssembly?"undefined":o(WebAssembly))&&"function"==typeof WebAssembly.instantiate&&"function"==typeof WebAssembly.compile){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));e instanceof WebAssembly.Module&&(this.wasmSupported=new WebAssembly.Instance(e)instanceof WebAssembly.Instance)}}catch(e){}this.polyfill()}return i(t,[{key:"polyfill",value:function(){Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var n=65535&e,o=65535&t;return n*o+((e>>>16)*o+n*(t>>>16)<<16)|0}),Math.imul=Math.imul,Math.fround||(Math.fround=function(e){return e}),Math.fround=Math.fround,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;t<32;t++)if(e&1<<31-t)return t;return 32}),Math.clz32=Math.clz32,Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Math.trunc=Math.trunc}},{key:"resolveDosBox",value:function(e,t){var n=this;this.global.exports.WDOSBOX?t.ondosbox(this.global.exports.WDOSBOX,this.global.exports.instantiateWasm):this.wasmSupported?(null===this.wdosboxPromise&&(this.wdosboxPromise=this.compileDosBox(e,t)),this.wdosboxPromise.then(function(e){setTimeout(function(){n.wdosboxPromise=null,t.ondosbox(n.global.exports.WDOSBOX,n.global.exports.instantiateWasm)},1)},function(e){setTimeout(function(){n.wdosboxPromise=null,t.onerror(e)},1)})):t.onerror("WebAssembly is not supported, can't resolve wdosbox")}},{key:"compileDosBox",value:function(r,a){var l=this,u=c.Build.wasmSize+c.Build.jsSize;return new Promise(function(i,s){var e=r.replace(".js",".wasm.js");new f.Xhr(e,{responseType:"arraybuffer",progress:function(e,t){a.onprogress&&a.onprogress("Resolving DosBox",u,t)},fail:function(e,t,n){s("Can't download wasm, code: "+t+", message: "+n+", url: "+e)},success:function(e){var t=WebAssembly.compile(e),o=function(e){s(e+"")};t.catch(o),t.then(function(n){l.global.exports.instantiateWasm=function(e,t){return WebAssembly.instantiate(n,e).catch(o).then(function(e){t(e,n)})},new f.Xhr(r,{progress:function(e,t){a.onprogress&&a.onprogress("Resolving DosBox",u,c.Build.wasmSize+t)},fail:function(e,t,n){s("Can't download wdosbox.js, code: "+t+", message: "+n+", url: "+e)},success:function(e){a.onprogress("Resolving DosBox",u,u),eval.call(window,e),i(l.global.exports.WDOSBOX)}})})}})})}}]),t}();n.Host=new s},{"./js-dos-build":1,"./js-dos-xhr":8}],5:[function(e,t,n){"use strict";var i=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var s=e("./js-dos-ci"),r=e("./js-dos-fs"),a=e("./js-dos-options"),l=e("./js-dos-ui"),o=function(e){function o(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return n.isValid=!1,n.canvas=null,n.ci=null,n.fs=null,n.ui=null,n.canvas=e,n.onready=t,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,a.DosOptions),i(o,[{key:"debug",value:function(e){this.log("[DEBUG] "+e)}},{key:"info",value:function(e){this.log("[INFO] "+e)}},{key:"warn",value:function(e){this.log("[WARN] "+e)}},{key:"error",value:function(e){this.log("[ERROR] "+e)}},{key:"ondosbox",value:function(e,t){this.info("DosBox resolved"),this.instantiateWasm=t,this.instance=new e(this)}},{key:"resolve",value:function(){var o=this;this.wdosboxUrl||(this.wdosboxUrl="wdosbox.js"),this.log||(this.log=function(e){return console.log(e)}),this.canvas?(this.onprogress||(this.ui=new l.DosUi(this),this.onprogress=function(e,t,n){return o.ui.onprogress(e,t,n)}),this.SDL={defaults:{widht:320,height:200,copyOnLock:!1,discardOnLock:!0,opaqueFrontBuffer:!1}},this.isValid=!0):this.onerror("canvas field is required, but not set!")}},{key:"onRuntimeInitialized",value:function(){var n=this;this.fs=new r.DosFS(this),this.onready({fs:this.fs,main:function(e){return null!==n.ui&&(n.ui.detach(),n.ui=null),e.unshift("-c","mount c .","-c","c:"),n.callMain(e),new Promise(function(t){new s.DosCommandInterface(n,function(e){t(e)})})}})}}]),o}();n.DosModule=o},{"./js-dos-ci":2,"./js-dos-fs":3,"./js-dos-options":6,"./js-dos-ui":7}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.DosOptions=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}},{}],7:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.css='\n    .dosbox-container { position: relative; min-width: 320px; min-height: 200px; display: inline-block; }\n    .dosbox-overlay, .dosbox-loader { position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(51, 51, 51, 0.7); }\n    .dosbox-start { text-align: center; position: absolute; left: 0; right: 0; bottom: 50%; color: #f80; font-size: 1.5em; text-decoration: underline; cursor: pointer; }\n    .dosbox-overlay a { color: #f80; }\n    .dosbox-powered { position: absolute; right: 1em; bottom: 1em; font-size: 0.8em; color: #9C9C9C; }\n    .dosbox-loader-message { text-align: center; position: absolute; left: 0; right: 0; bottom: 50%; margin: 0 0 -3em 0; box-sizing: border-box; color: #f80; font-size: 1.5em; }\n    @-moz-keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } @-webkit-keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } @keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } .st-loader { width: 10em; height: 2.5em; position: absolute; top: 50%; left: 50%; margin: -1.25em 0 0 -5em; box-sizing: border-box; }\n    .st-loader:before, .st-loader:after { content: ""; display: block; position: absolute; top: 0; bottom: 0; width: 1.25em; box-sizing: border-box; border: 0.25em solid #f80; }\n    .st-loader:before { left: -0.76923em; border-right: 0; }\n    .st-loader:after { right: -0.76923em; border-left: 0; }\n    .st-loader .equal { display: block; position: absolute; top: 50%; margin-top: -0.5em; left: 4.16667em; height: 1em; width: 1.66667em; border: 0.25em solid #f80; box-sizing: border-box; border-width: 0.25em 0; -moz-animation: loading 1.5s infinite ease-in-out; -webkit-animation: loading 1.5s infinite ease-in-out; animation: loading 1.5s infinite ease-in-out; background: #f80; }\n    ',this.overlayHtml='\n        <div class="dosbox-loader">\n            <div class="st-loader">\n                <span class="equal"></span>\n            </div>\n            <div class="dosbox-loader-message"></div>\n        </div>\n        <div class="dosbox-powered">\n            Powered by &nbsp;<a href="https://js-dos.com">js-dos.com</a> (6.22)\n        </div>\n    ',this.dos=e,this.canvas=e.canvas;try{if(null===document.getElementById("js-dos-ui-css")){var t=document.createElement("style");t.id="js-dos-ui-css",t.innerHTML=this.css,document.head.appendChild(t)}if("dosbox-container"!==this.canvas.parentElement.className){var n=document.createElement("div");n.className="dosbox-container",this.canvas.parentElement.replaceChild(n,this.canvas),n.appendChild(this.canvas);var o=document.createElement("div");o.className="dosbox-overlay",n.appendChild(o),o.innerHTML=this.overlayHtml}var i=this.canvas.parentElement;this.overlay=this.childById(i,"dosbox-overlay"),this.loaderMessage=this.childById(this.overlay,"dosbox-loader-message"),this.hidden=!1,this.hide()}catch(e){this.onprogress=this.onprogressFallback}}return o(s,[{key:"onprogress",value:function(e,t,n){var o=e+" "+Math.round(100*n/t*10)/10+"%";this.loaderMessage.innerHTML=o,this.dos.info(o),t<=n?this.hide():this.show()}},{key:"detach",value:function(){this.hide(),this.onprogress=this.onprogressFallback}},{key:"hide",value:function(){this.hidden||(this.hidden=!0,this.overlay.setAttribute("style","display: none"))}},{key:"show",value:function(){this.hidden&&(this.hidden=!1,this.overlay.setAttribute("style","display: block"))}},{key:"onprogressFallback",value:function(e,t,n){this.dos.info(e+" "+100*n/t+"%")}},{key:"childById",value:function(e,t){if(null===e)return null;for(var n=0;n<e.childElementCount;++n){var o=e.children[n];if(o.className===t)return o;if(null!==(o=this.childById(o,t)))return o}return null}}]),s}();n.DosUi=i},{}],8:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function s(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.total=0,this.loaded=0,this.resource=e,this.options=t,this.options.method=t.method||"GET",this.xhr=new XMLHttpRequest,this.xhr.open(this.options.method,e,!0),"POST"===this.options.method&&this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.overrideMimeType("text/plain; charset=x-user-defined");var o=void 0;"function"==typeof(o=this.xhr).addEventListener&&o.addEventListener("progress",function(e){if(n.total=e.total,n.loaded=e.loaded,n.options.progress)return n.options.progress(e.total,e.loaded)});var i=void 0;"function"==typeof(i=this.xhr).addEventListener&&i.addEventListener("error",function(e){if(n.options.fail)return n.options.fail(n.resource,n.xhr.status,"connection problem"),delete n.options.fail}),this.xhr.onreadystatechange=function(){return n.onReadyStateChange()},this.options.responseType&&(this.xhr.responseType=this.options.responseType),this.xhr.send(this.options.data)}return o(s,[{key:"onReadyStateChange",value:function(){if(4===this.xhr.readyState)if(200===this.xhr.status){if(this.options.success){var e=Math.max(this.total,this.loaded);return this.options.progress(e,e),this.options.success(this.xhr.response)}}else if(this.options.fail)return this.options.fail(this.resource,this.xhr.status,"connection problem"),delete this.options.fail}},{key:"arrayBufferToString",value:function(e){for(var t=new Uint16Array(e),n=t.length,o="",i=Math.pow(2,16)-1,s=0;s<n;)n<s+i&&(i=n-s),o+=String.fromCharCode.apply(null,t.subarray(s,s+i)),s+=i;return o}}]),s}();n.Xhr=i},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./js-dos-host"),a=e("./js-dos-module");function o(i,s){var e=new Promise(function(e,t){var n=new a.DosModule(i,e);Object.assign(n,s);var o=n.onerror;n.onerror=function(e){t(e);setTimeout(function(){n.onerror=o?(o(e),o):n.error},1)},n.resolve(),n.isValid&&r.Host.resolveDosBox(n.wdosboxUrl,n)});return e.ready=function(t){e.then(function(e){t(e.fs,e.main)})},e}n.Dos=o,window.Dos=o},{"./js-dos-host":4,"./js-dos-module":5}]},{},[9]);
//# sourceMappingURL=js-dos.js.map
